0.20.0 Release Notes Draft
===============================

Bitcoin Core version 0.20.0 is now available from:

  <https://bitcoincore.org/bin/bitcoin-core-0.20.0/>

This release includes new features, various bug fixes and performance
improvements, as well as updated translations.

Please report bugs using the issue tracker at GitHub:

  <https://github.com/bitcoin/bitcoin/issues>

To receive security and update notifications, please subscribe to:

  <https://bitcoincore.org/en/list/announcements/join/>

How to Upgrade
==============

If you are running an older version, shut it down. Wait until it has completely
shut down (which might take a few minutes for older versions), then run the
installer (on Windows) or just copy over `/Applications/Bitcoin-Qt` (on Mac)
or `bitcoind`/`bitcoin-qt` (on Linux).

Upgrading directly from a version of Bitcoin Core that has reached its EOL is
possible, but it might take some time if the datadir needs to be migrated. Old
wallet versions of Bitcoin Core are generally supported.

Compatibility
==============

Bitcoin Core is supported and extensively tested on operating systems using
the Linux kernel, macOS 10.12+, and Windows 7 and newer. It is not recommended
to use Bitcoin Core on unsupported systems.

Bitcoin Core should also work on most other Unix-like systems but is not
as frequently tested on them.

From Bitcoin Core 0.20.0 onwards, macOS versions earlier than 10.12 are no
longer supported. Additionally, Bitcoin Core does not yet change appearance
when macOS "dark mode" is activated.

In addition to previously supported CPU platforms, this release's pre-compiled
distribution provides binaries for the RISC-V platform.

Known Bugs
==========

The non-git source code release has undergone some refactoring in an effort to make it more complete, however, there are a few regressions in this release:
- The `configure` script is currently missing, and you will need to install autotools and run `./autogen.sh` before you can run `./configure`.
- Instead of running `make` simply, you should instead run `BITCOIN_GENBUILD_NO_GIT=1 make`.

Notable changes
===============

P2P and network changes
-----------------------

#### Removal of reject network messages from Bitcoin Core (BIP61)

The command line option to enable BIP61 (`-enablebip61`) has been removed.
(#17004)

This feature has been disabled by default since Bitcoin Core version 0.18.0.
Nodes on the network can not generally be trusted to send valid ("reject")
messages, so this should only ever be used when connected to a trusted node.
Please use the recommended alternatives if you rely on this removed feature:

* Testing or debugging of implementations of the Bitcoin P2P network protocol
  should be done by inspecting the log messages that are produced by a recent
  version of Bitcoin Core. Bitcoin Core logs debug messages
  (`-debug=<category>`) to a stream (`-printtoconsole`) or to a file
  (`-debuglogfile=<debug.log>`).

* Testing the validity of a block can be achieved by specific RPCs:
  - `submitblock`
  - `getblocktemplate` with `'mode'` set to `'proposal'` for blocks with
    potentially invalid POW

* Testing the validity of a transaction can be achieved by specific RPCs:
  - `sendrawtransaction`
  - `testmempoolaccept`

* Wallets should not assume a transaction has propagated to the network
  just because there are no reject messages.  Instead, listen for the
  transaction to be announced by other peers on the network.  Wallets
  should not assume a lack of reject messages means a transaction pays
  an appropriate fee.  Instead, set fees using fee estimation and use
  replace-by-fee to increase a tranaction's fee if it hasn't confirmed
  within the desired amount of time.

The removal of BIP61 reject message support also has the following minor RPC
and logging implications:

* `testmempoolaccept` and `sendrawtransaction` no longer return the P2P reject
  code when a transaction is not accepted to the mempool. They still return the
  verbal reject reason.

* Log messages that previously reported the reject code when a transaction was
  not accepted to the mempool now no longer report the reject code. The reason
  for rejection is still reported.

Updated RPCs
------------

- The RPCs which accept descriptors now accept the new `sortedmulti(...)` descriptor
  type which supports multisig scripts where the public keys are sorted
  lexicographically in the resulting script.  (#17056)

- The `walletprocesspsbt` and `walletcreatefundedpsbt` RPCs now include
  BIP32 derivation paths by default for public keys if we know them.
  This can be disabled by setting the `bip32derivs` parameter to
  `false`.  (#17264)

- The `bumpfee` RPC's parameter `totalFee`, which was deprecated in
  0.19, has been removed.  (#18312)

- The `getpeerinfo` RPC now includes a `mapped_as` field to indicate the mapped Autonomous System used for diversifying peer selection. See the `-asmap` configuration option in _New Settings_, below.
  (#16702)

Build System
------------

- OpenSSL is no longer used by Bitcoin Core.  (#17265)

- BIP70 support has been fully removed from Bitcoin Core. The
`--enable-bip70` option remains, but will throw an error during configure.
(#17165)

- glibc 2.17 or greater is now required to run the release binaries. This
retains compatibility with RHEL 7, CentOS 7, Debian 8 and Ubuntu 14.04 LTS.
Further details can be found in #17538. (#17538)

- The source code archives that are provided with gitian builds no longer contain
any autotools artifacts. Therefore, to build from such source a user
should run the `./autogen.sh` script from the root of the unpacked archive.
This implies that `autotools` and other required packages are installed on the
user's system. (#18331)

New settings
------------

- New `rpcwhitelist` and `rpcwhitelistdefault` configuration parameters
  allow giving certain RPC users permissions to only some RPC calls.
  (#12763)

- A new `-asmap` configuration option has been added to enable IP-to-ASN mapping
  for bucketing of the network peers to diversify the network connections. The
  legacy /16 prefix mapping remains the default. See [issue
  #16599](https://github.com/bitcoin/bitcoin/issues/16599), [PR
  #16702](https://github.com/bitcoin/bitcoin/pull/16702), and the `bitcoind
  help` for more information. This option is experimental and subject to removal
  or breaking changes in future releases. (#16702)

Updated settings
----------------

- Importing blocks upon startup via the `bootstrap.dat` file no longer occurs by default. The file must now be specified with `-loadblock=<file>`.  (#17044)

- The `-debug=db` logging category has been renamed to `-debug=walletdb`, to distinguish it from `coindb`.
  `-debug=db` has been deprecated and will be removed in the next major release.
  (#17410)

GUI changes
-----------

- The "Start Bitcoin Core on system login" option has been removed on macOS.
  (#17567)

- In the Peers window, the details for a peer now displays a `Mapped AS` field to indicate the mapped Autonomous System used for diversifying peer selection. See the `-asmap` configuration option in _New Settings_, above.  (#18402)

Wallet
------

- The wallet now by default uses bech32 addresses when using RPC, and creates native segwit change outputs.  (#16884)

- The way that output trust was computed has been fixed, which affects confirmed/unconfirmed balance status and coin selection.  (#16766)

- The `gettransaction`, `listtransactions` and `listsinceblock` RPC responses now also
include the height of the block that contains the wallet transaction, if any.  (#17437)

- The `getaddressinfo` RPC has had its `label` field deprecated
  (re-enable for this release using the configuration parameter
  `-deprecatedrpc=label`).  The `labels` field is altered from returning
  JSON objects to returning a JSON array of label names (re-enable
  previous behavior for this release using the configuration parameter
  `-deprecatedrpc=labelspurpose`).  Backwards compatibility using the
  deprecated configuration parameters is expected to be droped in the
  0.21 release.  (#17585, #17578)

Low-level changes
=================

Utilities
---------

- The `bitcoin-cli` utility used with the `-getinfo` parameter will no longer return
  the `protocolversion`, `walletversion`, and `keypoololdest` fields.  (#17650)

Command line
------------

- Command line options prefixed with main/test/regtest network names like
`-main.port=8333` `-test.server=1` previously were allowed but ignored. Now
they trigger "Invalid parameter" errors on startup. (#17482)

Updated RPCs
------------

- The `verifychain` RPC default values are now static, instead of depending on the command line options or configuration file (`-checklevel`, and `-checkblocks`). Users can pass in the RPC arguments explicitly when they don't want to rely on the default values. (#18541)

Tests
-----

- It is now an error to use an unqualified `walletdir=path` setting in the config file if running on testnet or regtest
  networks. The setting now needs to be qualified as `chain.walletdir=path` or placed in the appropriate `[chain]`
  section. (#17447)

- `-fallbackfee` was 0 (disabled) by default for the main chain, but 0.0002 by default for the test chains. Now it is 0
  by default for all chains. Testnet and regtest users will have to add `fallbackfee=0.0002` to their configuration if
  they weren't setting it and they want it to keep working like before. (#16524)

0.20.0 change log
=================

Credits
=======

Thanks to everyone who directly contributed to this release:


As well as to everyone that helped with translations on
[Transifex](https://www.transifex.com/bitcoin/bitcoin/).